<%#
  Modern Flash Messages Partial

  This partial renders flash messages using Vue component when available,
  falling back to Bootstrap-style alerts for legacy pages.

  Usage:
    <%= render 'shared/flash_messages' %>

  Options:
    position: 'top-right' (default), 'top-left', 'bottom-right', 'bottom-left', 'top-center', 'bottom-center'

  Example with options:
    <%= render 'shared/flash_messages', position: 'top-center' %>
%>

<% position ||= 'top-right' %>

<%# Convert Rails flash to array format for Vue %>
<% flash_data = flash.map { |type, message|
  normalized_type = case type.to_s
    when 'notice' then 'success'
    when 'alert' then 'error'
    when 'danger' then 'error'
    else type.to_s
  end
  { type: normalized_type, message: message }
} %>

<%# Modern Vue component (if Vite is available) %>
<% if vite_asset_available? %>
  <%= vue_component('FlashMessages',
    initialMessages: flash_data,
    position: position,
    class: 'flash-messages-container'
  ) %>
<% else %>
  <%# Legacy Bootstrap-style fallback %>
  <div class="flash-messages-legacy">
    <% flash.each do |type, message| %>
      <%
        alert_class = case type.to_s
          when 'notice', 'success' then 'alert-success'
          when 'alert', 'error', 'danger' then 'alert-error'
          when 'warning' then 'alert-warning'
          else 'alert-info'
        end
      %>
      <div class="alert <%= alert_class %>" role="alert">
        <div class="alert-content">
          <%= message %>
        </div>
        <button type="button" class="alert-dismiss" onclick="this.parentElement.remove()">
          <span aria-hidden="true">&times;</span>
          <span class="sr-only">Cerrar</span>
        </button>
      </div>
    <% end %>
  </div>
<% end %>
